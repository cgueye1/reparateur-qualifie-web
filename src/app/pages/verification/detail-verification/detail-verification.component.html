<div class="w-full">

  <!-- ======================= HEADER ======================= -->
  <div class="flex flex-col md:flex-row items-start md:items-center justify-between mb-6">

    <!-- RETOUR + NOM + ID -->
    <div class="flex items-start md:items-center gap-4">
      <!-- Retour -->
      <button
        (click)="goBack()"
        class="bg-[#F8FBF9] rounded-lg shadow p-1.5 flex items-center justify-center w-12 h-12"
      >
        <svg width="18" height="14" viewBox="0 0 18 14" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M16.75 6.75H0.75M0.75 6.75L6.75 0.75M0.75 6.75L6.75 12.75"
                stroke="#2B3674" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>

      <div>
        <h1 class="text-2xl font-semibold text-[#111]">{{ user.nom }}</h1>
        <p class="text-sm text-[#343A40]">ID : {{ user.id }}</p>
      </div>
    </div>

    <!-- BOUTONS APPROUVER / REJETER -->
    <div class="flex items-center gap-4 mt-4 md:mt-0">

      <!-- Approuver -->
      <button
        (click)="openApprovePopup(demande)"
        class="px-6 py-2 rounded-lg font-medium text-white"
        style="background:#008D36;"
      >
        Approuver
      </button>

      <!-- Rejeter -->
      <button
        (click)="openRejectPopup(demande)"
        class="px-6 py-2 rounded-lg font-medium text-white"
        style="background:#E95F32;"
      >
        Rejeter
      </button>

    </div>
  </div>



  <!-- ========================== LAYOUT  ========================== -->
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-5 auto-rows-fr">


    <!-- ======================= COLONNE 1 : PROFIL ======================= -->
    <div class="bg-white rounded-2xl shadow-sm p-6 h-full">

      <!-- Bandeau -->
      <div class="w-full h-28 rounded-xl bg-gradient-to-r from-orange-50 to-gray-50 relative flex items-center justify-center">
        <div class="absolute -bottom-10">
          <div class="w-24 h-24 rounded-full overflow-hidden border-4 border-white shadow-md">
            <img *ngIf="user.photo" [src]="user.photo" class="w-full h-full object-cover" />
            <div *ngIf="!user.photo" class="w-full h-full flex items-center justify-center bg-gray-300 text-[#555] font-bold">
              {{ user.initials }}
            </div>
          </div>

         <div
  class="w-4 h-4 rounded-full border-2 border-white absolute bg-[#008D36]"
  style="bottom: 2px; right: 20px;">

</div>

        </div>
      </div>

      <div class="mt-14 text-center">
        <h2 class="text-xl font-semibold">{{ user.nom }}</h2>
        <p class="text-[#333333]">{{ user.metier }}</p>
      </div>

      <div class="my-6 border-t"></div>

      <!-- INFOS PROFIL -->
      <div class="flex flex-col gap-5 text-gray-700">

        <!-- Métier -->
        <div class="flex items-start justify-between">
          <div class="flex items-center gap-3">
            <span>{{ user.metier }}</span>
          </div>
          <span class="text-gray-400 text-sm">Métier</span>
        </div>

        <!-- Email -->
        <div class="flex items-center gap-3">
          <span>{{ user.email }}</span>
        </div>

        <!-- Téléphone -->
        <div class="flex items-center gap-3">
          <span>{{ user.telephone }}</span>
        </div>

        <!-- Ville -->
        <div class="flex items-center gap-3">
          <span>{{ user.ville }}</span>
        </div>

        <!-- Date inscription -->
        <div class="flex items-start justify-between">
          <span>{{ user.dateInscription }}</span>
          <span class="text-gray-400 text-sm">Date d’inscription</span>
        </div>

      </div>

    </div>




    <!-- ======================= COLONNE DROITE ======================= -->
    <div class="lg:col-span-2 bg-white rounded-2xl shadow-sm p-6">

      <!-- TITRE + STATUT -->
      <div class="flex items-start justify-between mb-6">
        <h2 class="text-2xl font-semibold text-[#2C3E50]">Informations sur la demande</h2>

        <span class="px-3 py-1 rounded-full text-xs font-medium"
              [ngClass]="
                demande.statut === 'En attente' ? 'bg-gray-100 text-gray-600' :
                demande.statut === 'Validée' ? 'bg-[#E6F5EC] text-[#008D36]' :
                'bg-[#FFECEC] text-[#FF2828]'">
          {{ demande.statut }}
        </span>
      </div>


      <!-- INFOS DE LA DEMANDE -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8 text-sm">

        <div>
          <p class="text-gray-500 text-xs">Date de demande</p>
          <p class="font-semibold">{{ demande.date }}</p>
        </div>

        <div>
          <p class="text-gray-500 text-xs">Plan Abonnement</p>
          <p class="font-semibold">{{ demande.plan }}</p>
        </div>

        <div>
          <p class="text-gray-500 text-xs">Montant Payé</p>
          <p class="font-semibold">{{ demande.montant }}</p>
        </div>

      </div>



      <!-- ======================= DOCUMENTS ======================= -->
      <h3 class="text-base font-semibold mb-4">Documents fournis ({{ documents.length }})</h3>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">

        <div *ngFor="let doc of documents"
             class="flex items-center justify-between border rounded-xl p-4 bg-white shadow-sm cursor-pointer">

          <div class="flex items-center gap-3">
            <!-- Icône PDF -->
            <svg width="16" height="20" viewBox="0 0 16 20" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M9 7H14.5L9 1.5V7ZM2 0H10L16 6V18C16 18.5304 15.7893 19.0391 15.4142 19.4142C15.0391 19.7893 14.5304 20 14 20H2C1.46957 20 0.960859 19.7893 0.585786 19.4142C0.210714 19.0391 0 18.5304 0 18V2C0 1.46957 0.210714 0.960859 0.585786 0.585786C0.960859 0.210714 1.46957 0 2 0ZM6.93 10.44C7.34 11.34 7.86 12.08 8.46 12.59L8.87 12.91C8 13.07 6.8 13.35 5.53 13.84L5.42 13.88L5.92 12.84C6.37 11.97 6.7 11.18 6.93 10.44ZM13.41 14.25C13.59 14.07 13.68 13.84 13.69 13.59C13.72 13.39 13.67 13.2 13.57 13.04C13.28 12.57 12.53 12.35 11.29 12.35L10 12.42L9.13 11.84C8.5 11.32 7.93 10.41 7.53 9.28L7.57 9.14C7.9 7.81 8.21 6.2 7.55 5.54C7.46927 5.46161 7.37378 5.40003 7.26907 5.35883C7.16435 5.31763 7.0525 5.29764 6.94 5.3H6.7C6.33 5.3 6 5.69 5.91 6.07C5.54 7.4 5.76 8.13 6.13 9.34V9.35C5.88 10.23 5.56 11.25 5.05 12.28L4.09 14.08L3.2 14.57C2 15.32 1.43 16.16 1.32 16.69C1.28 16.88 1.3 17.05 1.37 17.23L1.4 17.28L1.88 17.59L2.32 17.7C3.13 17.7 4.05 16.75 5.29 14.63L5.47 14.56C6.5 14.23 7.78 14 9.5 13.81C10.53 14.32 11.74 14.55 12.5 14.55C12.94 14.55 13.24 14.44 13.41 14.25ZM13 13.54L13.09 13.65C13.08 13.75 13.05 13.76 13 13.78H12.96L12.77 13.8C12.31 13.8 11.6 13.61 10.87 13.29C10.96 13.19 11 13.19 11.1 13.19C12.5 13.19 12.9 13.44 13 13.54ZM3.83 15C3.18 16.19 2.59 16.85 2.14 17C2.19 16.62 2.64 15.96 3.35 15.31L3.83 15ZM6.85 8.09C6.62 7.19 6.61 6.46 6.78 6.04L6.85 5.92L7 5.97C7.17 6.21 7.19 6.53 7.09 7.07L7.06 7.23L6.9 8.05L6.85 8.09Z" fill="#EF5350"/>
</svg>


            <div>
              <p class="font-medium text-sm">{{ doc.nom }}</p>
              <p class="text-xs text-gray-500">{{ doc.taille }}</p>
            </div>
          </div>

          <!-- Téléchargement -->
          <button class="text-gray-500 hover:text-[#008D36]">
            <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M7 10.577L3.461 7.039L4.169 6.319L6.5 8.65V0H7.5V8.65L9.83 6.32L10.539 7.039L7 10.577ZM1.616 14C1.15533 14 0.771 13.846 0.463 13.538C0.155 13.23 0.000666667 12.8453 0 12.384V9.961H1V12.384C1 12.538 1.064 12.6793 1.192 12.808C1.32 12.9367 1.461 13.0007 1.615 13H12.385C12.5383 13 12.6793 12.936 12.808 12.808C12.9367 12.68 13.0007 12.5387 13 12.384V9.961H14V12.384C14 12.8447 13.846 13.229 13.538 13.537C13.23 13.845 12.8453 13.9993 12.384 14H1.616Z" fill="#8F9BBA"/>
</svg>

          </button>
        </div>

      </div>

    </div>

  </div>

</div>





















<!-- POPUP CONFIRM APPROUVER -->
<div *ngIf="showApproveConfirm" class="fixed inset-0 z-50 bg-black/40 flex items-center justify-center p-4">
  <div class="bg-white rounded-2xl px-10 py-12 w-[460px] text-center shadow-xl">

    <!-- Icône -->
     <div class="w-full flex items-center justify-center mb-6">
    <svg width="65" height="65" viewBox="0 0 95 95" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M51.2407 58.166L43.8188 58.166L43.8188 28.4785L51.2407 28.4785L51.2407 58.166Z" fill="#EFBD8E"/>
      <path d="M47.5 65.291C45.3685 65.291 43.6406 67.0189 43.6406 69.1504C43.6406 71.2819 45.3685 73.0098 47.5 73.0098C49.6315 73.0098 51.3594 71.2819 51.3594 69.1504C51.3594 67.0189 49.6315 65.291 47.5 65.291Z" fill="#EFBD8E"/>
      <path d="M47.5 94.9776C59.6972 95.3703 71.5436 90.595 80.446 81.6968C89.3483 72.7986 94.5815 60.5025 95 47.5C94.5815 34.4975 89.3483 22.2014 80.446 13.3032C71.5436 4.40504 59.6972 -0.370316 47.5 0.0224457C35.3028 -0.370316 23.4564 4.40504 14.554 13.3032C5.65166 22.2014 0.418472 34.4975 0 47.5C0.418472 60.5025 5.65166 72.7986 14.554 81.6968C23.4564 90.595 35.3028 95.3703 47.5 94.9776ZM47.5 7.93537C57.7293 7.54133 67.6886 11.4827 75.1994 18.8972C82.7101 26.3117 87.1609 36.5959 87.5781 47.5C87.1609 58.4041 82.7101 68.6883 75.1994 76.1028C67.6886 83.5174 57.7293 87.4587 47.5 87.0646C37.2707 87.4587 27.3114 83.5174 19.8006 76.1028C12.2899 68.6883 7.83908 58.4041 7.42188 47.5C7.83908 36.5959 12.2899 26.3117 19.8006 18.8972C27.3114 11.4827 37.2707 7.54133 47.5 7.93537Z" fill="#EFBD8E"/>
    </svg>
  </div>

    <h2 class="text-xl font-bold mb-2">Approuver la demande</h2>

    <p class="text-sm text-gray-600 mb-8">
      Êtes-vous sûr de vouloir <b>approuver</b> cette demande ?
    </p>

    <div class="flex justify-center gap-4">
      <button (click)="confirmApprove()" class="bg-green-600 text-white px-8 py-3 rounded-lg hover:bg-green-700">
        Approuver
      </button>
      <button (click)="closeAllPopups()" class="bg-gray-100 px-8 py-3 rounded-lg hover:bg-gray-200">
        Annuler
      </button>
    </div>

  </div>
</div>




<!-- POPUP REJET MOTIF -->
<div *ngIf="showRejectForm" class="fixed inset-0 z-50 bg-black/40 flex items-center justify-center p-4">
  <div class="bg-white rounded-2xl px-10 py-10 w-[520px] shadow-xl">

    <div class="flex justify-between items-start mb-4">
      <h2 class="text-xl font-bold">Rejeter la demande</h2>

      <button (click)="closeAllPopups()" class="text-gray-500 hover:text-gray-800">
        ✕
      </button>
    </div>

    <p class="text-sm text-gray-600 mb-5">
      Veuillez indiquer la raison du rejet. L'artisan recevra cette information par email.
    </p>

    <label class="text-sm font-semibold text-gray-700">Motif du rejet</label>
    <textarea
      [(ngModel)]="rejectReason"
      class="w-full border border-gray-300 rounded-lg p-3 text-sm mt-2"
      rows="4"
      placeholder="Ex : Documents incomplets, photo de mauvaise qualité..."
    ></textarea>

    <div class="flex justify-end gap-4 mt-6">
      <button
        (click)="confirmReject()"
        class="bg-[#E95420] text-white px-6 py-3 rounded-lg hover:bg-[#d64515]"
      >
        Confirmer le rejet
      </button>

      <button
        (click)="closeAllPopups()"
        class="bg-gray-100 px-6 py-3 rounded-lg hover:bg-gray-200"
      >
        Annuler
      </button>
    </div>

  </div>
</div>


<!-- SUCCESS APPROUVE -->
<div *ngIf="showSuccessApprove" class="fixed inset-0 z-50 bg-black/40 flex items-center justify-center p-4">
  <div class="bg-white rounded-2xl w-[420px] p-10 text-center shadow-xl">

    <div class="w-full flex items-center justify-center mb-4">
      <svg width="65" height="65" viewBox="0 0 95 95" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M70.2452 34.0264C70.9106 34.7294 71.27 35.6677 71.2443 36.6353C71.2186 37.6029 70.81 38.5208 70.1082 39.1875L43.3438 64.7644C42.6518 65.4153 41.736 65.7751 40.7861 65.7692C39.8501 65.7728 38.9494 65.4125 38.2741 64.7644L24.8918 51.976C24.5207 51.6521 24.2188 51.2566 24.0044 50.8131C23.79 50.3696 23.6675 49.8874 23.6442 49.3954C23.6209 48.9033 23.6973 48.4117 23.8689 47.9499C24.0405 47.4882 24.3037 47.0659 24.6426 46.7085C24.9816 46.3511 25.3893 46.0659 25.8413 45.87C26.2932 45.6742 26.7801 45.5718 27.2727 45.5689C27.7653 45.566 28.2534 45.6628 28.7076 45.8534C29.1618 46.044 29.5728 46.3244 29.9159 46.6779L40.7861 57.0457L65.0841 33.8894C65.7871 33.224 66.7254 32.8646 67.693 32.8903C68.6606 32.916 69.5785 33.3246 70.2452 34.0264ZM95 47.5C95 56.8946 92.2142 66.0782 86.9948 73.8896C81.7754 81.7009 74.357 87.7891 65.6775 91.3843C56.998 94.9794 47.4473 95.9201 38.2332 94.0873C29.0191 92.2545 20.5554 87.7305 13.9124 81.0876C7.26945 74.4446 2.74552 65.9809 0.91272 56.7668C-0.920077 47.5527 0.020581 38.002 3.61574 29.3225C7.2109 20.643 13.2991 13.2246 21.1104 8.00519C28.9218 2.78583 38.1054 0 47.5 0C60.0904 0.0241427 72.1582 5.03635 81.0609 13.9391C89.9637 22.8418 94.9759 34.9096 95 47.5ZM87.6923 47.5C87.6923 39.5507 85.3351 31.7799 80.9187 25.1703C76.5023 18.5608 70.2251 13.4092 62.8809 10.3671C55.5368 7.32509 47.4554 6.52915 39.6589 8.07997C31.8623 9.6308 24.7008 13.4587 19.0798 19.0797C13.4588 24.7007 9.63082 31.8623 8.08 39.6589C6.52917 47.4554 7.32511 55.5367 10.3672 62.8809C13.4092 70.2251 18.5608 76.5023 25.1704 80.9187C31.78 85.3351 39.5507 87.6923 47.5 87.6923C58.156 87.6802 68.372 83.4418 75.9069 75.9069C83.4418 68.372 87.6802 58.1559 87.6923 47.5Z" fill="#008D36"/>
      </svg>
    </div>

    <p class="text-lg font-medium text-gray-700">
      Vérification approuvée avec succès
    </p>

  </div>
</div>


<!-- SUCCESS REJET -->
<div *ngIf="showSuccessReject" class="fixed inset-0 z-50 bg-black/40 flex items-center justify-center p-4">
  <div class="bg-white rounded-2xl w-[420px] p-10 text-center shadow-xl">

    <div class="w-full flex items-center justify-center mb-4">
      <svg width="65" height="65" viewBox="0 0 95 95" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M70.2452 34.0264C70.9106 34.7294 71.27 35.6677 71.2443 36.6353C71.2186 37.6029 70.81 38.5208 70.1082 39.1875L43.3438 64.7644C42.6518 65.4153 41.736 65.7751 40.7861 65.7692C39.8501 65.7728 38.9494 65.4125 38.2741 64.7644L24.8918 51.976C24.5207 51.6521 24.2188 51.2566 24.0044 50.8131C23.79 50.3696 23.6675 49.8874 23.6442 49.3954C23.6209 48.9033 23.6973 48.4117 23.8689 47.9499C24.0405 47.4882 24.3037 47.0659 24.6426 46.7085C24.9816 46.3511 25.3893 46.0659 25.8413 45.87C26.2932 45.6742 26.7801 45.5718 27.2727 45.5689C27.7653 45.566 28.2534 45.6628 28.7076 45.8534C29.1618 46.044 29.5728 46.3244 29.9159 46.6779L40.7861 57.0457L65.0841 33.8894C65.7871 33.224 66.7254 32.8646 67.693 32.8903C68.6606 32.916 69.5785 33.3246 70.2452 34.0264ZM95 47.5C95 56.8946 92.2142 66.0782 86.9948 73.8896C81.7754 81.7009 74.357 87.7891 65.6775 91.3843C56.998 94.9794 47.4473 95.9201 38.2332 94.0873C29.0191 92.2545 20.5554 87.7305 13.9124 81.0876C7.26945 74.4446 2.74552 65.9809 0.91272 56.7668C-0.920077 47.5527 0.020581 38.002 3.61574 29.3225C7.2109 20.643 13.2991 13.2246 21.1104 8.00519C28.9218 2.78583 38.1054 0 47.5 0C60.0904 0.0241427 72.1582 5.03635 81.0609 13.9391C89.9637 22.8418 94.9759 34.9096 95 47.5ZM87.6923 47.5C87.6923 39.5507 85.3351 31.7799 80.9187 25.1703C76.5023 18.5608 70.2251 13.4092 62.8809 10.3671C55.5368 7.32509 47.4554 6.52915 39.6589 8.07997C31.8623 9.6308 24.7008 13.4587 19.0798 19.0797C13.4588 24.7007 9.63082 31.8623 8.08 39.6589C6.52917 47.4554 7.32511 55.5367 10.3672 62.8809C13.4092 70.2251 18.5608 76.5023 25.1704 80.9187C31.78 85.3351 39.5507 87.6923 47.5 87.6923C58.156 87.6802 68.372 83.4418 75.9069 75.9069C83.4418 68.372 87.6802 58.1559 87.6923 47.5Z" fill="#008D36"/>
      </svg>
    </div>

    <p class="text-lg font-medium text-gray-700">
      Demande rejetée.
    </p>

  </div>
</div>
